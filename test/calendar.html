<!DOCTYPE html>
<html lang="zh-cn">
<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width,minimum-scale=1.0,maximum-scale=1.0,user-scalable=no">
	<meta content="fullscreen=yes,preventMove=no" name="ML-Config">
	<title>test</title>
<script type="text/javascript" src="../js/jquery/1.11.1/jquery.js"></script>
<!--	<script type="text/javascript" src="../js/qmik.min.js"></script>-->
</head>
<body>
<script>
var calendar = (function(){
	var calen = function(){},
	config = {
		width: 350,
		style: '',
		styleEle: null,
        minDate: 0, //日期范围最小值(yyyyMMdd) 0. 表示不设定
        maxDate: 0, //日期范围最大值(yyyyMMdd) 0. 表示不设定
        ranged: 1 //是否包含日期边界值: 0. 不包含; 1. 包含
	},
	lang = {
		weekDay: {
			zh: ['日', '一', '二', '三', '四', '五', '六'],
			en: ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat']
		}
	},
	util = {
		today: function(){
			return new Date();
		},
		getMonthDays: function(yy, mm){ //获取某年某月有多少天
			var date = new Date();
			date.setFullYear(yy);
			date.setMonth(mm);
			date.setDate(0);
			var days = date.getDate();
			return days;
		},
		getMonthOne: function(yy, mm){ //获取某年某月第一天是星期几
			var date = new Date();
			date.setFullYear(yy);
			date.setMonth(mm-1);
			date.setDate(1);
			var week = date.getDay();
			return week;
		},
		getNYearMonth: function(yy, mm, n){
			if(n > 0){
				if(mm + n > 12){
					mm = 1;
					yy++;
				} else {
					mm++;
				}
			} else {
				if(mm + n <= 0){
					mm = 12;
					yy--;
				} else {
					mm--;
				}
			}
			return {
				YY: yy,
				MM: mm
			};
		},
		setDate: function(dateObj) {
			if (dateObj == null || dateObj == undefined) {
				return null;
			}
			var ret = null;
			var x = typeof(dateObj);
			try {
				if (x == 'string') {
					ret = new Date(trim(dateObj).replace(/[^0-9: ]+/g, '/'));
				} else if (x == 'object') {
					if (dateObj.getTime()) {
						ret = new Date(dateObj.getTime());
					}
				}
			} catch (e) {
				ret = null;
			}
			return ret;
		},
		setStyle: function() {
			var _width = config.width;
			config.style = '.calendar-wrap {width:'+_width+'px;height: auto; margin: 0 auto;border:1px solid #ddd;box-shadow:5px 5px 5px #999;}'
			             + '.calendar-wrap ul {overflow: hidden;padding: 0;margin: 0;}'
			             + '.calendar-wrap ul li {list-style: none; display: inline-block;float:left; width:'+_width/7+'px; height:'+_width/7+'px;line-height:'+_width/7+'px;text-align:center;box-sizing: border-box; cursor:pointer; border-radius:'+_width/14+'px;}'
			             + '.calendar-wrap .calen-head, .calen-week {border-bottom: 1px solid #ddd;}'
			             + '.calendar-wrap .calen-week li {border:none;cursor:default;}'
			             + '.calendar-wrap .calen-days li:hover {color:#555;background-color:#eee;}'
			             + '.calendar-wrap .calen-days .today {color:#fff;background-color:#34a3ec;}'
			             + '.calendar-wrap .calen-days .outday {color: #999;}'
			             + '.calendar-wrap .calen-days .disabled {color: #999;}'
			             + '.calendar-wrap .calen-days .disabled:hover {color: #ddd;background-color:#fff;}'
			             + '.calendar-wrap .calen-head {width: 100%;height:40px; line-height:40px;overflow: hidden;}'
			             + '.calendar-wrap .calen-head span {display: inline-block;float: left; text-align: center;}'
			             + '.calendar-wrap .month-up, .month-down {width: 20%; cursor: pointer;}'
			             + '.calendar-wrap .month-up:hover, .month-down:hover {background: #eee;}'
			             + '.calendar-wrap .month-year {width: 60%;}';
		    config.styleEle = $('<style>');
		    config.styleEle.html(config.style).appendTo('head');
		},
		getDateNumbers: function(date) {
			return {
				year: date.getFullYear(),
				month: date.getMonth() + 1,
				day: date.getDate()
			};
		},
		getIntegerOfDay: function(yy, mm, dd) {
			if (yy == null) {
				return 0;
			}
			if (arguments.length == 1) {
				var x = util.getDateNumbers(yy);
				return x.year * 10000 + x.month * 100 + x.day;
			} else {
				return yy * 10000 + mm * 100 + dd;
			}
		},
		checkDateRange: function(yyMMdd) {
			var set = config;
			console.log(config);
			if(set.minDate == 0 && set.maxDate == 0) {
				return true;
			}
			if(set.minDate == 0) {
				return set.ranged == 1 ? (yyMMdd <= set.maxDate) : (yyMMdd < set.maxDate);
			} else if(set.maxDate == 0) {
				return set.ranged == 1 ? (yyMMdd >= set.minDate) : (yyMMdd > set.minDate);
			}
			if (set.ranged == 1) {
				return yyMMdd >= set.minDate && yyMMdd <= set.maxDate;
			} else {
				return yyMMdd > set.minDate && yyMMdd < set.maxDate;
			}
		}
	},
	events = {
		setHeaderYM: function(yy, mm){
			var monthYear = $('.month-year');
			monthYear.attr('data-date', yy+'-'+mm);
			monthYear.text(yy + "年 " + mm + '月');
		},
		createDay: function(yy, mm){
			this.dayRange = function(obj, nday){				
				var isRange = util.checkDateRange(nday);
				console.log(isRange);
				if(isRange) {
					obj.removeClass('disabled');
					obj.css('cursor', 'pointer');
					obj.on('click', function(){
						events.dayOnclick($(this));
					});
				}else{
					obj.attr('class', 'disabled');
					obj.css('cursor', 'default');
					obj.off('click');
				}
				/*obj.axis = x;
				obj.className = '';
				obj.style.backgroundColor = config.dayBgColor[1];
				obj.style.color = isRange === true ? config.dayColor[x === 0 ? 1 : 0] :
					config.dayColor[2];
				obj.style.cursor = isRange === true ? 'pointer' : 'default';
				obj.onmousemove = isRange === true ? events.dayOnMouseMove : events.emptyFunc;
				obj.onmouseout = isRange === true ? events.dayOnMouseOut : events.emptyFunc;
				obj.onclick = isRange === true ? events.dayOnClick : events.emptyFunc;*/
			};
			events.setHeaderYM(yy, mm);
			var firstday = util.getMonthOne(yy, mm);
			var days = util.getMonthDays(yy, mm);
			var alldays = $('.calen-days li');
			//上月
			var pre = util.getNYearMonth(yy, mm, -1);
			var preMonthDays = util.getMonthDays(pre.YY, pre.MM);
			for(var i=0; i <= firstday; i++){
				var theDay = $(alldays[firstday-i-1]);
				theDay.attr('data-date', yy+'-'+(mm-1)+'-'+(preMonthDays-i));
				theDay.text(preMonthDays-i).addClass('outday');
				theDay.removeClass('today');
				this.dayRange(theDay, util.getIntegerOfDay(yy, mm-1, preMonthDays-i));
			}
			//本月
			var today = util.today(),
				tdY = today.getFullYear(),
				tdM = today.getMonth()+1,
				tdD = today.getDate(),
				tdStr = tdY+'-'+tdM+'-'+tdD;
			for(var i=0; i < days; i++){
				var theDay = $(alldays[firstday+i]),
					theDayStr = yy+'-'+mm+'-'+(i+1);
				theDay.attr('data-date', theDayStr);
				theDay.text(i+1);
				theDay.removeClass('today');
				if(theDay.hasClass('outday')){
					theDay.removeClass('outday');
				}
				if(tdStr == theDayStr) {
					theDay.addClass('today');
				}
				this.dayRange(theDay, util.getIntegerOfDay(yy, mm, i+1));
			}
			//下月
			var xx = parseInt(firstday+days);
			var next = util.getNYearMonth(yy, mm, 1);
			for(var i=0; i <= 42-firstday-days; i++){
				var theDay = $(alldays[xx+i]);
				theDay.attr('data-date', yy+'-'+(mm+1)+'-'+(i+1));
				theDay.text(i+1).addClass('outday');
				theDay.removeClass('today');
				this.dayRange(theDay, util.getIntegerOfDay(yy, mm+1, i+1));
			}			
		},
		turnMonth: function(n){
			var ymArr = $('.month-year').attr('data-date').split('-'),
				year = parseInt(ymArr[0]),
				month = parseInt(ymArr[1]);
			if(n != 0){
				var xday = util.getNYearMonth(year, month, n);
				year = xday.YY;
				month = xday.MM;
			}
			events.createDay(year, month);
		},
		dayOnclick: function(dom){
			var date = $(dom).attr('data-date');
			alert(date);
		}
	},
	dialog = function(){
		util.setStyle();
		this.getHeaderPanel = function() {
			var header = $('<div>', {'class': 'calen-head'});
			$('<span>', {
				'class': 'month-up',
				text: ' < ',
				click: function() {
					events.turnMonth(-1);
				}
			}).appendTo(header);
			$('<span>', {
				'class': 'month-year',
				text: ''
			}).appendTo(header);
			$('<span>', {
				'class': 'month-down',
				text: ' > ',
				click: function() {
					events.turnMonth(1);
				}
			}).appendTo(header);
			return header;
		};
		this.getWeekDayPanel = function() {
			var week = $('<ul>', {'class': 'calen-week'});
			for(var i=0; i<7; i++) {
				$('<li>', {text: lang.weekDay.zh[i]}).appendTo(week);
			}
			return week;
		};
		this.getDaysPanel = function() {
			var days = $('<ul>', {'class': 'calen-days'});
			for(var i=0; i<42; i++) {
				$('<li>', {
					text: '',
					'data-date': '',
					click: function(){
						events.dayOnclick(this);
					}
				}).appendTo(days);
			}
			return days;
		};
		var wrap = $('<div>', {'class': 'calendar-wrap'});
		var _body = $('<div>', {'class': 'calendar-body'});
		_body.append(this.getWeekDayPanel());
		_body.append(this.getDaysPanel());
		wrap.append(this.getHeaderPanel());
		wrap.append(_body);
		$('body').append(wrap);
	};
	calen.setDay = function(obj){
		var now = new Date();
		var yy = now.getFullYear(), mm = now.getMonth();
		if(obj) {
			try {
				config.width = obj.width;
				// config.minDate = obj.minDate;
				// config.maxDate = obj.maxDate;
			} catch (e) {
				console.log(e);
			}
		}
		dialog();
		events.createDay(yy, mm+1);
	};
	calen.setStyle = function(str){
		if(str) {
			var old = config.styleEle.html();
			config.styleEle.html(old + str);
		}
	};
	calen.setDateRange = function(minDate, maxDate, ranged) {
		config.minDate = util.getIntegerOfDay(util.setDate(minDate));
		config.maxDate = util.getIntegerOfDay(util.setDate(maxDate));
		config.ranged = ranged === false ? 0 : 1;
	};
	return calen;
})();
calendar.setDateRange('2015-11-14','', 1);
calendar.setDay({width: 300});
calendar.setStyle('');

</script>
</body>
</html>